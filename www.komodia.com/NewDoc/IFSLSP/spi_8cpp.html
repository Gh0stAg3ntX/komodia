<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<META name="Komodia is a company/firm specializes in
network/LSP (Layered Service Provider) projects. Download free source code samples before contracting us to see our skills">
<META name="keywords" content="socket,programming,tcp,ip,udp,icmp,LSP,DNS,SSL,sniffer">
<title>Winsock IFS LSP sample from &quot;Platform SDK&quot;: spi.cpp File Reference</title>
</head>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6898822-1");
pageTracker._trackPageview();
} catch(err) {}</script>
<body>
<link rel="stylesheet" href="style.css" type="text/css">
<link rel="stylesheet" href="layout.css" type="text/css">
<link rel="shortcut icon" href="http://www.komodia.com/NewDoc/IFSLSP/fevicon.png" type="image/x-icon">
<script type="text/javascript" src="menu.js" ></script>
<div class="ban_bg">
<div class="banner width">  
</div>
</div>
<div class="menu width">

<ul class="ul">
<li><a href="../../index.php.html" rel="nofollow"><div class="m">HOME</div></a></li>
<li><a href="../../index.php@page=products.html" rel="nofollow"><div class="m">PRODUCTS</div></a></li>
<li><a href="../../index.php@page=newtools.html" rel="nofollow"><div class="m">DOWNLOADS</div></a></li>
<li><a href="../../index.php@page=lsp.html" rel="nofollow"><div class="m">LSP GUIDE</div></a></li>
<li><a href="../../index.php@page=newcontact.html" rel="nofollow"><div class="m">CONTACT</div></a></li>
<li><a href="../../index.php@page=about.html" rel="nofollow"><div class="m">ABOUT</div></a></li>
</ul>

</div>
<p><br><br></p>

<hr />
<div class="tools_content"><h2>Retail products</h2>
<hr />
   
    <div class="boxes width h">
	<div class="box_left" id="clearfix" >
    <div class="head_txt">Traffic interception SDK <p></p>
    <span>Control every TCP/IP network connection</span><p></p>
    <ul>    
    <li class="txt" >Route connections via proxy</li><p></p>
    <li class="txt" >Redirect connections and modify the data</li><p></p>
    <li class="txt" >Block connections and applications</li>
    </ul>
    <div class="learn"><a href="../../index.php@page=redirector.html" rel="nofollow">Learn More</a></div>
    </div>


    	<!--<div class="bl_top" ></div>
        <div class="bl_midle" ></div>
        <div class="bl_bottom"></div>-->
    </div>
  <div class="seperate" id="clearfix"></div>
    <div class="box_right" id="clearfix">
    
    <div class="head_txt">SSL interception SDK<p></p>
    <span>View SSL in plaintext and modify it</span><p></p>
    <ul>    
    <li class="txt" >View the SSL stream decrypted in plaintext</li><p></p>
    <li class="txt" >Redirect SSL connection and modify decrypted data</li><p></p>
    <li class="txt" >Browser shows "SSL lock" without warnings</li>
    </ul>
    <div class="learn"><a href="../../index.php@page=ssl.html" rel="nofollow">Learn More</a></div>
    	<!--<div class="br_top" ></div>
        <div class="br_midle" ></div>
        <div class="br_bottom"></div>-->
  </div>
</div></div>
   

<hr />
<div class="tools_content"><h2>Documentation</h2>
<hr />
</div>
</div>
<link rel="stylesheet" href="doxygen.css" type="text/css">
<table>
<td align=left>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>spi.cpp File Reference</h1><code>#include &quot;<a class="el" href="lspdef_8h-source.html">lspdef.h</a>&quot;</code><br>
<code>#include &lt;strsafe.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>

<p>
<div class="dynheader">
Include dependency graph for spi.cpp:</div>
<div class="dynsection">
<p><center><img src="spi_8cpp__incl.png" border="0" usemap="#spi.cpp_map" alt=""></center>
<map name="spi.cpp_map">
<area shape="rect" href="lspdef_8h.html" title="lspdef.h" alt="" coords="255,80,321,107"><area shape="rect" href="lspcommon_8h.html" title="lspcommon.h" alt="" coords="605,155,704,181"></map>
</div>

<p>
<a href="spi_8cpp-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#03292201bb4771719a391fbd31c4237f">DEFAULT_PRINT_BUFFER</a>&nbsp;&nbsp;&nbsp;512</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#7dad64c6e124337603820bd11d462832">FindUrl</a> (__in_ecount(buflen) char *buf, int buflen, __out char **start)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">BOOL WINAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#adbcfca3e3e0afdc1236899d2098d6a8">DllMain</a> (IN HINSTANCE hinstDll, IN DWORD dwReason, LPVOID lpvReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#f498f85e68835b690146948c49141b0d">WSPCleanup</a> (LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#bb968dbf233213ef753854e39e67d645">WSPCloseSocket</a> (SOCKET s, LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#2c900291405ce06aa0df88d0be385261">WSPConnect</a> (SOCKET s, const struct sockaddr FAR *name, int namelen, LPWSABUF lpCallerData, LPWSABUF lpCalleeData, LPQOS lpSQOS, LPQOS lpGQOS, LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#519725ece79c3dc4ef02c3ddd18947ce">WSPGetPeerName</a> (SOCKET s, struct sockaddr FAR *name, LPINT namelen, LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#bb2fc8baae3676e0b96bc063fff51555">WSPGetSockOpt</a> (SOCKET s, int level, int optname, __out_bcount(*optlen) char FAR *optval, __inout LPINT optlen, LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#045adcc3ba0d8f55b7f5fd581b29f289">WSPIoctl</a> (SOCKET s, DWORD dwIoControlCode, LPVOID lpvInBuffer, DWORD cbInBuffer, LPVOID lpvOutBuffer, DWORD cbOutBuffer, LPDWORD lpcbBytesReturned, LPWSAOVERLAPPED lpOverlapped, LPWSAOVERLAPPED_COMPLETION_ROUTINE lpCompletionRoutine, LPWSATHREADID lpThreadId, LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#152c06ee6e32c46e01087c6c31f89948">WSPSend</a> (SOCKET s, LPWSABUF lpBuffers, DWORD dwBufferCount, LPDWORD lpNumberOfBytesSent, DWORD dwFlags, LPWSAOVERLAPPED lpOverlapped, LPWSAOVERLAPPED_COMPLETION_ROUTINE lpCompletionRoutine, LPWSATHREADID lpThreadId, LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">SOCKET WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#9263b25bef174302fec2ee7b4713aa61">WSPSocket</a> (int af, int type, int protocol, LPWSAPROTOCOL_INFOW lpProtocolInfo, GROUP g, DWORD dwFlags, LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">SOCKET WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#4af8d3a0e7ccd2d8219c9a172b4c0993">WSPAccept</a> (SOCKET s, struct sockaddr FAR *addr, LPINT addrlen, LPCONDITIONPROC lpfnCondition, DWORD_PTR dwCallbackData, LPINT lpErrno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int WSPAPI&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#63ec3df09eaf63af14d2f5237a9d29ee">WSPStartup</a> (WORD wVersion, LPWSPDATA lpWSPData, LPWSAPROTOCOL_INFOW lpProtocolInfo, WSPUPCALLTABLE UpCallTable, LPWSPPROC_TABLE lpProcTable)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#75c7c71e871f8732f37ebfba8dad6051">FindDestinationAddress</a> (<a class="el" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a> *context, const SOCKADDR *destAddr, int destLen, SOCKADDR **proxyAddr, int *proxyLen)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#8bf7931217eec7b59c7c7d321abbcf1c">FreeLspProviders</a> (<a class="el" href="struct__PROVIDER.html">PROVIDER</a> *lspProvider, int lspProviderCount, int *lpErrno)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CRITICAL_SECTION&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">WSPUPCALLTABLE&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#2e86220b11aa751cf68d403988dd882d">gMainUpCallTable</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__PROVIDER.html">LPPROVIDER</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#2f9b8fb232be410a39ef4a9e2e42f806">gLayerInfo</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi_8cpp.html#1097a55ef8326f3dd71c321b2b64a046">gLayerCount</a> = 0</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="03292201bb4771719a391fbd31c4237f"></a><!-- doxytag: member="spi.cpp::DEFAULT_PRINT_BUFFER" ref="03292201bb4771719a391fbd31c4237f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_PRINT_BUFFER&nbsp;&nbsp;&nbsp;512          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00037">37</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="adbcfca3e3e0afdc1236899d2098d6a8"></a><!-- doxytag: member="spi.cpp::DllMain" ref="adbcfca3e3e0afdc1236899d2098d6a8" args="(IN HINSTANCE hinstDll, IN DWORD dwReason, LPVOID lpvReserved)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL WINAPI DllMain           </td>
          <td>(</td>
          <td class="paramtype">IN HINSTANCE&nbsp;</td>
          <td class="paramname"> <em>hinstDll</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN DWORD&nbsp;</td>
          <td class="paramname"> <em>dwReason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPVOID&nbsp;</td>
          <td class="paramname"> <em>lpvReserved</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00081">81</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00086"></a>00086 {
<a name="l00087"></a>00087     UNREFERENCED_PARAMETER( hinstDll );
<a name="l00088"></a>00088     UNREFERENCED_PARAMETER( lpvReserved );
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordflow">switch</span> (dwReason)
<a name="l00091"></a>00091     {
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         <span class="keywordflow">case</span> DLL_PROCESS_ATTACH:
<a name="l00094"></a>00094             <span class="comment">//</span>
<a name="l00095"></a>00095             <span class="comment">// Initialize some critical section objects </span>
<a name="l00096"></a>00096             <span class="comment">//</span>
<a name="l00097"></a>00097             __try
<a name="l00098"></a>00098             {
<a name="l00099"></a>00099                 InitializeCriticalSection( &amp;<a class="code" href="lspdef_8h.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a> );
<a name="l00100"></a>00100                 InitializeCriticalSection( &amp;<a class="code" href="lspcommon_8h.html#77d02cadc123791898d4c8ab1101dd2b">gDebugCritSec</a> );
<a name="l00101"></a>00101             }
<a name="l00102"></a>00102             __except( EXCEPTION_EXECUTE_HANDLER )
<a name="l00103"></a>00103             {
<a name="l00104"></a>00104                 <span class="keywordflow">goto</span> cleanup;
<a name="l00105"></a>00105             }
<a name="l00106"></a>00106             <span class="keywordflow">break</span>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         <span class="keywordflow">case</span> DLL_THREAD_ATTACH:
<a name="l00109"></a>00109             <span class="keywordflow">break</span>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="keywordflow">case</span> DLL_THREAD_DETACH:
<a name="l00112"></a>00112             <span class="keywordflow">break</span>;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114         <span class="keywordflow">case</span> DLL_PROCESS_DETACH:
<a name="l00115"></a>00115             gDetached = TRUE;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117             EnterCriticalSection( &amp;<a class="code" href="lspdef_8h.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a> );
<a name="l00118"></a>00118             <span class="keywordflow">if</span> ( NULL != <a class="code" href="lspdef_8h.html#f3639b63ffeaa56de64a8fb3f20f5e4f">gLayerInfo</a> )
<a name="l00119"></a>00119             {
<a name="l00120"></a>00120                 <span class="keywordtype">int</span> Error;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122                 <span class="comment">// Free LSP structures if still present as well as call WSPCleanup</span>
<a name="l00123"></a>00123                 <span class="comment">//    for all providers this LSP loaded</span>
<a name="l00124"></a>00124                 <a class="code" href="lspdef_8h.html#8bf7931217eec7b59c7c7d321abbcf1c">FreeLspProviders</a>( <a class="code" href="lspdef_8h.html#f3639b63ffeaa56de64a8fb3f20f5e4f">gLayerInfo</a>, <a class="code" href="lspdef_8h.html#71c050fcab3a91e3c6c59d0a5c8b69d1">gLayerCount</a>, &amp;Error );
<a name="l00125"></a>00125                 <a class="code" href="lspdef_8h.html#f3639b63ffeaa56de64a8fb3f20f5e4f">gLayerInfo</a> = NULL;
<a name="l00126"></a>00126                 <a class="code" href="lspdef_8h.html#71c050fcab3a91e3c6c59d0a5c8b69d1">gLayerCount</a> = 0;
<a name="l00127"></a>00127             }
<a name="l00128"></a>00128             LeaveCriticalSection( &amp;<a class="code" href="lspdef_8h.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a> );
<a name="l00129"></a>00129 
<a name="l00130"></a>00130             DeleteCriticalSection( &amp;<a class="code" href="lspdef_8h.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a> );
<a name="l00131"></a>00131             DeleteCriticalSection( &amp;<a class="code" href="lspcommon_8h.html#77d02cadc123791898d4c8ab1101dd2b">gDebugCritSec</a> );
<a name="l00132"></a>00132 
<a name="l00133"></a>00133             <span class="keywordflow">break</span>;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="keywordflow">return</span> TRUE;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 cleanup:
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="keywordflow">return</span> FALSE;
<a name="l00141"></a>00141 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="75c7c71e871f8732f37ebfba8dad6051"></a><!-- doxytag: member="spi.cpp::FindDestinationAddress" ref="75c7c71e871f8732f37ebfba8dad6051" args="(SOCKET_CONTEXT *context, const SOCKADDR *destAddr, int destLen, SOCKADDR **proxyAddr, int *proxyLen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FindDestinationAddress           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a> *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const SOCKADDR *&nbsp;</td>
          <td class="paramname"> <em>destAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>destLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SOCKADDR **&nbsp;</td>
          <td class="paramname"> <em>proxyAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>proxyLen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l01049">1049</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01056"></a>01056 {
<a name="l01057"></a>01057     UNREFERENCED_PARAMETER( context );
<a name="l01058"></a>01058     UNREFERENCED_PARAMETER( destLen );
<a name="l01059"></a>01059     UNREFERENCED_PARAMETER( proxyAddr );
<a name="l01060"></a>01060     UNREFERENCED_PARAMETER( proxyLen );
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#4e9bdbc601c1363d1e0ab050a5ed4283">AddressLength</a> = destLen;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     <span class="comment">// Save destination address</span>
<a name="l01065"></a>01065     memcpy( &amp;context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#1e75eacfa5d85115f90f873acaff245c">OriginalAddress</a>, destAddr, context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#4e9bdbc601c1363d1e0ab050a5ed4283">AddressLength</a> );
<a name="l01066"></a>01066 
<a name="l01067"></a>01067     *proxyAddr = (SOCKADDR *) &amp;context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#1e75eacfa5d85115f90f873acaff245c">OriginalAddress</a>;
<a name="l01068"></a>01068     *proxyLen  = context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#4e9bdbc601c1363d1e0ab050a5ed4283">AddressLength</a>;
<a name="l01069"></a>01069 
<a name="l01070"></a>01070     if ( destAddr-&gt;sa_family == AF_INET )
<a name="l01071"></a>01071     {
<a name="l01072"></a>01072         <span class="comment">// Redirect one destination to another</span>
<a name="l01073"></a>01073         <span class="keywordflow">if</span> ( ( (SOCKADDR_IN *)destAddr )-&gt;sin_addr.s_addr == inet_addr(<span class="stringliteral">"157.56.236.201"</span>) )
<a name="l01074"></a>01074         {
<a name="l01075"></a>01075             memcpy( &amp;context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#75a33a564e32c7e158c5547c8bbda89f">ProxiedAddress</a>, destAddr, context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#4e9bdbc601c1363d1e0ab050a5ed4283">AddressLength</a> );
<a name="l01076"></a>01076             ( (SOCKADDR_IN *)&amp;context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#75a33a564e32c7e158c5547c8bbda89f">ProxiedAddress</a> )-&gt;sin_addr.s_addr = inet_addr(
<a name="l01077"></a>01077                     <span class="stringliteral">"157.56.237.9"</span>
<a name="l01078"></a>01078                     );
<a name="l01079"></a>01079 
<a name="l01080"></a>01080             *proxyAddr = (SOCKADDR *) &amp;context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#75a33a564e32c7e158c5547c8bbda89f">ProxiedAddress</a>;
<a name="l01081"></a>01081 
<a name="l01082"></a>01082             context-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#d3750087ffc3572e83b243c57da6d6b4">Proxied</a> = TRUE;
<a name="l01083"></a>01083         }
<a name="l01084"></a>01084     }
<a name="l01085"></a>01085     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( destAddr-&gt;sa_family == AF_INET6 )
<a name="l01086"></a>01086     {
<a name="l01087"></a>01087         <span class="comment">// Perform redirection here</span>
<a name="l01088"></a>01088     }
<a name="l01089"></a>01089 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7dad64c6e124337603820bd11d462832"></a><!-- doxytag: member="spi.cpp::FindUrl" ref="7dad64c6e124337603820bd11d462832" args="(__in_ecount(buflen) char *buf, int buflen, __out char **start)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int FindUrl           </td>
          <td>(</td>
          <td class="paramtype">__in_ecount(buflen) char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__out char **&nbsp;</td>
          <td class="paramname"> <em>start</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l01144">1144</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01149"></a>01149 {
<a name="l01150"></a>01150     <span class="keywordtype">char</span>   *subptr = NULL, *substart = NULL;
<a name="l01151"></a>01151     <span class="keywordtype">int</span>     subidx,
<a name="l01152"></a>01152             idx;
<a name="l01153"></a>01153 
<a name="l01154"></a>01154     *start = NULL;
<a name="l01155"></a>01155 
<a name="l01156"></a>01156     <span class="comment">// Perform a substring search starting at the beginning of 'buf'</span>
<a name="l01157"></a>01157     idx = 0;
<a name="l01158"></a>01158     <span class="keywordflow">while</span> ( idx &lt; buflen )
<a name="l01159"></a>01159     {
<a name="l01160"></a>01160         substart = buf;
<a name="l01161"></a>01161         subidx   = idx;
<a name="l01162"></a>01162         subptr   = <span class="stringliteral">"GET"</span>;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164         <span class="comment">// Once a character is matched proceed to check for a complete match </span>
<a name="l01165"></a>01165         <span class="comment">//    while ensuring we don't go past the end of the buffer (since it may not</span>
<a name="l01166"></a>01166         <span class="comment">//    be NULL terminated -- at least not the portion we're currently looking</span>
<a name="l01167"></a>01167         <span class="comment">//    at)</span>
<a name="l01168"></a>01168         <span class="keywordflow">while</span> ( ( subidx &lt; buflen ) &amp;&amp; ( *subptr != <span class="charliteral">'\0'</span> ) &amp;&amp; ( *subptr == *substart ) )
<a name="l01169"></a>01169         {
<a name="l01170"></a>01170             subptr++;
<a name="l01171"></a>01171             substart++;
<a name="l01172"></a>01172             subidx++;
<a name="l01173"></a>01173         }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175         <span class="comment">// If 'subptr' is pointing to NULL then a match to "GET" was found</span>
<a name="l01176"></a>01176         <span class="keywordflow">if</span> ( *subptr == <span class="charliteral">'\0'</span> )
<a name="l01177"></a>01177         {
<a name="l01178"></a>01178             <span class="comment">// A GET request was found so skip over the subsequent space</span>
<a name="l01179"></a>01179             idx = subidx + 1;
<a name="l01180"></a>01180             
<a name="l01181"></a>01181             <span class="comment">// Validate we're still within the buffer</span>
<a name="l01182"></a>01182             <span class="keywordflow">if</span> ( idx &gt;= buflen )
<a name="l01183"></a>01183             {
<a name="l01184"></a>01184                 <span class="comment">// Went past the buffer so return no match</span>
<a name="l01185"></a>01185                 <span class="keywordflow">return</span> 0;
<a name="l01186"></a>01186             }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188             *start = substart + 1;  <span class="comment">// Advance the character pointer past the space</span>
<a name="l01189"></a>01189 
<a name="l01190"></a>01190             substart++;
<a name="l01191"></a>01191             subidx = idx;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193             <span class="comment">// Advance the search pointer until we hit the end space</span>
<a name="l01194"></a>01194             <span class="keywordflow">while</span> ( ( subidx &lt; buflen ) &amp;&amp; ( *substart != <span class="charliteral">' '</span> ) )
<a name="l01195"></a>01195             {
<a name="l01196"></a>01196                 substart++;
<a name="l01197"></a>01197                 subidx++;
<a name="l01198"></a>01198             }
<a name="l01199"></a>01199 
<a name="l01200"></a>01200             <span class="comment">// If we're sitting on the trailing space, we found a URL so return</span>
<a name="l01201"></a>01201             <span class="comment">//    how many bytes are in the URL</span>
<a name="l01202"></a>01202             <span class="keywordflow">if</span> ( *substart == <span class="charliteral">' '</span> )
<a name="l01203"></a>01203             {
<a name="l01204"></a>01204                 <span class="keywordflow">return</span> subidx - idx;
<a name="l01205"></a>01205             }
<a name="l01206"></a>01206             <span class="keywordflow">else</span>
<a name="l01207"></a>01207             {
<a name="l01208"></a>01208                 <span class="comment">// Error occured so just return since we're not where we expected</span>
<a name="l01209"></a>01209                 <span class="keywordflow">return</span> 0;
<a name="l01210"></a>01210             }
<a name="l01211"></a>01211         }
<a name="l01212"></a>01212 
<a name="l01213"></a>01213         <span class="comment">// Advance the main pointers and index and start the search with the next</span>
<a name="l01214"></a>01214         <span class="comment">//    string location</span>
<a name="l01215"></a>01215         buf++;
<a name="l01216"></a>01216         idx++;
<a name="l01217"></a>01217     }
<a name="l01218"></a>01218 
<a name="l01219"></a>01219     <span class="keywordflow">return</span> 0;
<a name="l01220"></a>01220 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8bf7931217eec7b59c7c7d321abbcf1c"></a><!-- doxytag: member="spi.cpp::FreeLspProviders" ref="8bf7931217eec7b59c7c7d321abbcf1c" args="(PROVIDER *lspProvider, int lspProviderCount, int *lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FreeLspProviders           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__PROVIDER.html">PROVIDER</a> *&nbsp;</td>
          <td class="paramname"> <em>lspProvider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lspProviderCount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l01098">1098</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01103"></a>01103 {
<a name="l01104"></a>01104     <span class="keywordtype">int</span>     i;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106     <span class="keywordflow">if</span> ( NULL == lspProvider )
<a name="l01107"></a>01107         <span class="keywordflow">return</span>;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109     <span class="comment">// Need to iterate through the LSP providers and call WSPCleanup accordingly</span>
<a name="l01110"></a>01110     <span class="keywordflow">for</span>(i=0; i &lt; lspProviderCount ;i++)
<a name="l01111"></a>01111     {
<a name="l01112"></a>01112         <span class="keywordflow">while</span>( 0 != lspProvider[ i ].StartupCount )
<a name="l01113"></a>01113         {
<a name="l01114"></a>01114             lspProvider[ i ].<a class="code" href="struct__PROVIDER.html#1231b41c6796828cbcb5d3db9a1b0b86">StartupCount</a>--;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116             lspProvider[ i ].<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPCleanup( lpErrno );
<a name="l01117"></a>01117         }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119         <span class="keywordflow">if</span> ( NULL != lspProvider[ i ].Module )
<a name="l01120"></a>01120         {
<a name="l01121"></a>01121             FreeLibrary( lspProvider[ i ].Module );
<a name="l01122"></a>01122             lspProvider[ i ].<a class="code" href="struct__PROVIDER.html#8d3e8541bedc6bca86a851a272ba7a72">Module</a> = NULL;
<a name="l01123"></a>01123         }
<a name="l01124"></a>01124     }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126     <span class="keywordflow">for</span>(i=0; i &lt; lspProviderCount ;i++)
<a name="l01127"></a>01127     {
<a name="l01128"></a>01128         <a class="code" href="lspdef_8h.html#1c0cb16bca444dedec8c9bf3b7c3e83e">FreeSocketContextList</a>( &amp;lspProvider[ i ] );
<a name="l01129"></a>01129         
<a name="l01130"></a>01130         DeleteCriticalSection( &amp;lspProvider[ i ].ProviderCritSec );
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133     <a class="code" href="lspcommon_8h.html#52c6ad065227219021013b8c5c4eff9c">LspFree</a>( lspProvider );
<a name="l01134"></a>01134 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4af8d3a0e7ccd2d8219c9a172b4c0993"></a><!-- doxytag: member="spi.cpp::WSPAccept" ref="4af8d3a0e7ccd2d8219c9a172b4c0993" args="(SOCKET s, struct sockaddr FAR *addr, LPINT addrlen, LPCONDITIONPROC lpfnCondition, DWORD_PTR dwCallbackData, LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SOCKET WSPAPI WSPAccept           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr FAR *&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>addrlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPCONDITIONPROC&nbsp;</td>
          <td class="paramname"> <em>lpfnCondition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD_PTR&nbsp;</td>
          <td class="paramname"> <em>dwCallbackData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00798">798</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00806"></a>00806 {
<a name="l00807"></a>00807     <a class="code" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a>     *sockContext = NULL,
<a name="l00808"></a>00808                        *acceptContext = NULL;
<a name="l00809"></a>00809     SOCKET              acceptProviderSocket = INVALID_SOCKET,
<a name="l00810"></a>00810                         sret;
<a name="l00811"></a>00811     <span class="keywordtype">int</span>                 rc;
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     sockContext = <a class="code" href="lspdef_8h.html#6f2312b459597aa6a8021bb1303f6d8a">FindSocketContext</a>( s );
<a name="l00814"></a>00814     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00815"></a>00815     {
<a name="l00816"></a>00816         *lpErrno = WSAENOTSOCK;
<a name="l00817"></a>00817         <span class="keywordflow">goto</span> cleanup;
<a name="l00818"></a>00818     }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPAccept );
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     <span class="comment">//</span>
<a name="l00823"></a>00823     <span class="comment">// Create the socket from the lower layer</span>
<a name="l00824"></a>00824     <span class="comment">//</span>
<a name="l00825"></a>00825     acceptProviderSocket = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPAccept(
<a name="l00826"></a>00826             s, 
<a name="l00827"></a>00827             addr, 
<a name="l00828"></a>00828             addrlen, 
<a name="l00829"></a>00829             lpfnCondition,
<a name="l00830"></a>00830             dwCallbackData,
<a name="l00831"></a>00831             lpErrno
<a name="l00832"></a>00832             );
<a name="l00833"></a>00833     <span class="keywordflow">if</span> ( INVALID_SOCKET == acceptProviderSocket )
<a name="l00834"></a>00834     {
<a name="l00835"></a>00835         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPAccept: NextProcTable.WSPAccept failed: %d"</span>, *lpErrno);
<a name="l00836"></a>00836         <span class="keywordflow">goto</span> cleanup;
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="comment">//</span>
<a name="l00840"></a>00840     <span class="comment">// Create the context information to be associated with this socket</span>
<a name="l00841"></a>00841     <span class="comment">//</span>
<a name="l00842"></a>00842     acceptContext = <a class="code" href="lspdef_8h.html#6d422aa5870787ade6e6065cdff0aa5f">CreateSocketContext</a>(
<a name="l00843"></a>00843             sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>,
<a name="l00844"></a>00844             acceptProviderSocket,
<a name="l00845"></a>00845             lpErrno
<a name="l00846"></a>00846             );
<a name="l00847"></a>00847     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00848"></a>00848     {
<a name="l00849"></a>00849         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>( <span class="stringliteral">"WSPAccept: CreateSocketContext failed: %d"</span>, *lpErrno );
<a name="l00850"></a>00850         <span class="keywordflow">goto</span> cleanup;
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     <span class="comment">//</span>
<a name="l00854"></a>00854     <span class="comment">// Associate ownership of this handle with our LSP</span>
<a name="l00855"></a>00855     <span class="comment">//</span>
<a name="l00856"></a>00856     sret = <a class="code" href="lspdef_8h.html#2e86220b11aa751cf68d403988dd882d">gMainUpCallTable</a>.lpWPUModifyIFSHandle(
<a name="l00857"></a>00857             sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#a56549aa76ce9437bfa255d6e8505d3a">LayerProvider</a>.dwCatalogEntryId,
<a name="l00858"></a>00858             acceptProviderSocket,
<a name="l00859"></a>00859             lpErrno
<a name="l00860"></a>00860             );
<a name="l00861"></a>00861     <span class="keywordflow">if</span> ( INVALID_SOCKET == sret )
<a name="l00862"></a>00862     {
<a name="l00863"></a>00863         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>( <span class="stringliteral">"WSPAccept: WPUModifyIFSHandle failed: %d"</span>, *lpErrno );
<a name="l00864"></a>00864         <span class="keywordflow">goto</span> cleanup;
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sret == acceptProviderSocket );
<a name="l00868"></a>00868 
<a name="l00869"></a>00869     <span class="keywordflow">return</span> acceptProviderSocket;
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 cleanup:
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     <span class="comment">// If an error occured close the socket if it was already created</span>
<a name="l00874"></a>00874     <span class="keywordflow">if</span> ( ( NULL != sockContext ) &amp;&amp; ( NULL != acceptContext ) &amp;&amp;
<a name="l00875"></a>00875          ( INVALID_SOCKET != acceptProviderSocket ) )
<a name="l00876"></a>00876     {
<a name="l00877"></a>00877         rc = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPCloseSocket(
<a name="l00878"></a>00878                 acceptProviderSocket,
<a name="l00879"></a>00879                 lpErrno
<a name="l00880"></a>00880                 );
<a name="l00881"></a>00881         <span class="keywordflow">if</span> ( SOCKET_ERROR == rc )
<a name="l00882"></a>00882         {
<a name="l00883"></a>00883             <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>( <span class="stringliteral">"WSPAccept: WSPCloseSocket failed: %d"</span>, *lpErrno );
<a name="l00884"></a>00884         }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887     <span class="keywordflow">if</span> ( ( NULL != sockContext ) &amp;&amp; ( NULL != acceptContext ) )
<a name="l00888"></a>00888         <a class="code" href="lspdef_8h.html#fa2103b5e5b6ad1a746a4d3533713d37">FreeSocketContext</a>( sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>, acceptContext );
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     <span class="keywordflow">return</span> INVALID_SOCKET;
<a name="l00891"></a>00891 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f498f85e68835b690146948c49141b0d"></a><!-- doxytag: member="spi.cpp::WSPCleanup" ref="f498f85e68835b690146948c49141b0d" args="(LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WSPAPI WSPCleanup           </td>
          <td>(</td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00151">151</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00154"></a>00154 {
<a name="l00155"></a>00155     <span class="keywordtype">int</span>        rc = SOCKET_ERROR;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <span class="keywordflow">if</span> ( gDetached )
<a name="l00158"></a>00158     {
<a name="l00159"></a>00159         rc = NO_ERROR;
<a name="l00160"></a>00160         <span class="keywordflow">goto</span> cleanup;
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="comment">//</span>
<a name="l00164"></a>00164     <span class="comment">// Grab the DLL global critical section</span>
<a name="l00165"></a>00165     <span class="comment">//</span>
<a name="l00166"></a>00166     EnterCriticalSection( &amp;<a class="code" href="lspdef_8h.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a> );
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <span class="comment">// Verify WSPStartup has been called</span>
<a name="l00169"></a>00169     <span class="keywordflow">if</span> ( 0 == gStartupCount )
<a name="l00170"></a>00170     {
<a name="l00171"></a>00171         *lpErrno = WSANOTINITIALISED;
<a name="l00172"></a>00172         <span class="keywordflow">goto</span> cleanup;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="comment">// Decrement the global entry count</span>
<a name="l00176"></a>00176     gStartupCount--;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <span class="keywordflow">if</span> ( 0 == gStartupCount )
<a name="l00179"></a>00179     {
<a name="l00180"></a>00180         <span class="comment">// Free LSP structures if still present as well as call WSPCleanup</span>
<a name="l00181"></a>00181         <span class="comment">//    for all providers this LSP loaded</span>
<a name="l00182"></a>00182         <a class="code" href="lspdef_8h.html#8bf7931217eec7b59c7c7d321abbcf1c">FreeLspProviders</a>( <a class="code" href="lspdef_8h.html#f3639b63ffeaa56de64a8fb3f20f5e4f">gLayerInfo</a>, <a class="code" href="lspdef_8h.html#71c050fcab3a91e3c6c59d0a5c8b69d1">gLayerCount</a>, lpErrno );
<a name="l00183"></a>00183         <a class="code" href="lspdef_8h.html#f3639b63ffeaa56de64a8fb3f20f5e4f">gLayerInfo</a> = NULL;
<a name="l00184"></a>00184         <a class="code" href="lspdef_8h.html#71c050fcab3a91e3c6c59d0a5c8b69d1">gLayerCount</a> = 0;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186     
<a name="l00187"></a>00187     rc = NO_ERROR;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 cleanup:
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     LeaveCriticalSection( &amp;<a class="code" href="lspdef_8h.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a> );
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="keywordflow">return</span> rc;
<a name="l00194"></a>00194 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bb968dbf233213ef753854e39e67d645"></a><!-- doxytag: member="spi.cpp::WSPCloseSocket" ref="bb968dbf233213ef753854e39e67d645" args="(SOCKET s, LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WSPAPI WSPCloseSocket           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00204">204</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <a class="code" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a> *sockContext = NULL;
<a name="l00210"></a>00210     <span class="keywordtype">int</span>             rc = SOCKET_ERROR;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="comment">// Find the socket context and remove it from the provider's list of sockets</span>
<a name="l00213"></a>00213     sockContext = <a class="code" href="lspdef_8h.html#6f2312b459597aa6a8021bb1303f6d8a">FindSocketContext</a>( s, TRUE );
<a name="l00214"></a>00214     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00215"></a>00215     {
<a name="l00216"></a>00216         *lpErrno = WSAENOTSOCK;
<a name="l00217"></a>00217         <span class="keywordflow">goto</span> cleanup;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPCloseSocket );
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <span class="comment">// Pass the socket down to close it</span>
<a name="l00223"></a>00223     rc = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPCloseSocket(
<a name="l00224"></a>00224             s,
<a name="l00225"></a>00225             lpErrno
<a name="l00226"></a>00226             );
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="comment">// Just free the structure as its alreayd removed from the provider's list</span>
<a name="l00229"></a>00229     <a class="code" href="lspcommon_8h.html#52c6ad065227219021013b8c5c4eff9c">LspFree</a>( sockContext );
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 cleanup:
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="keywordflow">return</span> rc;
<a name="l00234"></a>00234 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2c900291405ce06aa0df88d0be385261"></a><!-- doxytag: member="spi.cpp::WSPConnect" ref="2c900291405ce06aa0df88d0be385261" args="(SOCKET s, const struct sockaddr FAR *name, int namelen, LPWSABUF lpCallerData, LPWSABUF lpCalleeData, LPQOS lpSQOS, LPQOS lpGQOS, LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WSPAPI WSPConnect           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct sockaddr FAR *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>namelen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSABUF&nbsp;</td>
          <td class="paramname"> <em>lpCallerData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSABUF&nbsp;</td>
          <td class="paramname"> <em>lpCalleeData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPQOS&nbsp;</td>
          <td class="paramname"> <em>lpSQOS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPQOS&nbsp;</td>
          <td class="paramname"> <em>lpGQOS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00246">246</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00256"></a>00256 {
<a name="l00257"></a>00257     <a class="code" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a> *sockContext = NULL;
<a name="l00258"></a>00258     SOCKADDR       *proxyAddr = NULL;
<a name="l00259"></a>00259     <span class="keywordtype">int</span>             proxyLen = 0,
<a name="l00260"></a>00260                     rc = SOCKET_ERROR;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="comment">// Find the socket context</span>
<a name="l00263"></a>00263     sockContext = <a class="code" href="lspdef_8h.html#6f2312b459597aa6a8021bb1303f6d8a">FindSocketContext</a>( s );
<a name="l00264"></a>00264     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00265"></a>00265     {
<a name="l00266"></a>00266         *lpErrno = WSAENOTSOCK;
<a name="l00267"></a>00267         <span class="keywordflow">goto</span> cleanup;
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPConnect );
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <a class="code" href="lspdef_8h.html#75c7c71e871f8732f37ebfba8dad6051">FindDestinationAddress</a>( sockContext, name, namelen, &amp;proxyAddr, &amp;proxyLen );
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     rc = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPConnect(
<a name="l00275"></a>00275             s,
<a name="l00276"></a>00276             proxyAddr, 
<a name="l00277"></a>00277             proxyLen, 
<a name="l00278"></a>00278             lpCallerData, 
<a name="l00279"></a>00279             lpCalleeData,
<a name="l00280"></a>00280             lpSQOS, 
<a name="l00281"></a>00281             lpGQOS, 
<a name="l00282"></a>00282             lpErrno
<a name="l00283"></a>00283             );
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 cleanup:
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="keywordflow">return</span> rc;
<a name="l00288"></a>00288 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="519725ece79c3dc4ef02c3ddd18947ce"></a><!-- doxytag: member="spi.cpp::WSPGetPeerName" ref="519725ece79c3dc4ef02c3ddd18947ce" args="(SOCKET s, struct sockaddr FAR *name, LPINT namelen, LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WSPAPI WSPGetPeerName           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr FAR *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>namelen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00299">299</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00305"></a>00305 {
<a name="l00306"></a>00306     <a class="code" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a> *sockContext = NULL;
<a name="l00307"></a>00307     <span class="keywordtype">int</span>             rc = SOCKET_ERROR;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="comment">//</span>
<a name="l00310"></a>00310     <span class="comment">// Find our provider socket corresponding to this one</span>
<a name="l00311"></a>00311     <span class="comment">//</span>
<a name="l00312"></a>00312     sockContext = <a class="code" href="lspdef_8h.html#6f2312b459597aa6a8021bb1303f6d8a">FindSocketContext</a>( s );
<a name="l00313"></a>00313     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00314"></a>00314     {
<a name="l00315"></a>00315         *lpErrno = WSAENOTSOCK;
<a name="l00316"></a>00316         <span class="keywordflow">goto</span> cleanup;
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">// If the connection has been proxied, return the address the application</span>
<a name="l00320"></a>00320     <span class="comment">//    originally tried to connect to.</span>
<a name="l00321"></a>00321     <span class="keywordflow">if</span> ( TRUE == sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#d3750087ffc3572e83b243c57da6d6b4">Proxied</a> )
<a name="l00322"></a>00322     {
<a name="l00323"></a>00323         __try
<a name="l00324"></a>00324         {
<a name="l00325"></a>00325             <span class="comment">// Verify buffer is large enough for underlying address structure</span>
<a name="l00326"></a>00326             <span class="keywordflow">if</span> ( *namelen &lt; sockContext-&gt;AddressLength )
<a name="l00327"></a>00327             {
<a name="l00328"></a>00328                 *namelen = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#4e9bdbc601c1363d1e0ab050a5ed4283">AddressLength</a>;
<a name="l00329"></a>00329                 *lpErrno = WSAEFAULT;
<a name="l00330"></a>00330                 <span class="keywordflow">goto</span> cleanup;
<a name="l00331"></a>00331             }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333             memcpy( name, &amp;sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#1e75eacfa5d85115f90f873acaff245c">OriginalAddress</a>, *namelen );
<a name="l00334"></a>00334             *namelen = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#4e9bdbc601c1363d1e0ab050a5ed4283">AddressLength</a>;
<a name="l00335"></a>00335         } 
<a name="l00336"></a>00336         __except( EXCEPTION_EXECUTE_HANDLER )
<a name="l00337"></a>00337         {
<a name="l00338"></a>00338             *lpErrno = WSAEFAULT;
<a name="l00339"></a>00339             <span class="keywordflow">goto</span> cleanup;
<a name="l00340"></a>00340         }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342         <span class="keywordflow">return</span> NO_ERROR;
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPGetPeerName );
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     rc = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPGetPeerName(
<a name="l00348"></a>00348             s,
<a name="l00349"></a>00349             name,
<a name="l00350"></a>00350             namelen, 
<a name="l00351"></a>00351             lpErrno
<a name="l00352"></a>00352             );
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 cleanup:
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <span class="keywordflow">return</span> rc;
<a name="l00357"></a>00357 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bb2fc8baae3676e0b96bc063fff51555"></a><!-- doxytag: member="spi.cpp::WSPGetSockOpt" ref="bb2fc8baae3676e0b96bc063fff51555" args="(SOCKET s, int level, int optname, __out_bcount(*optlen) char FAR *optval, __inout LPINT optlen, LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WSPAPI WSPGetSockOpt           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>optname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__out_bcount *optlen char FAR *&nbsp;</td>
          <td class="paramname"> <em>optval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__inout LPINT&nbsp;</td>
          <td class="paramname"> <em>optlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00366">366</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00374"></a>00374 {
<a name="l00375"></a>00375     <a class="code" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a> *sockContext = NULL;
<a name="l00376"></a>00376     <span class="keywordtype">int</span>             rc = NO_ERROR;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <span class="comment">// Retrieve the socket context</span>
<a name="l00379"></a>00379     sockContext = <a class="code" href="lspdef_8h.html#6f2312b459597aa6a8021bb1303f6d8a">FindSocketContext</a>( s );
<a name="l00380"></a>00380     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00381"></a>00381     {
<a name="l00382"></a>00382         *lpErrno = WSAENOTSOCK;
<a name="l00383"></a>00383         rc = SOCKET_ERROR;
<a name="l00384"></a>00384         <span class="keywordflow">goto</span> cleanup;
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPGetSockOpt );
<a name="l00388"></a>00388 
<a name="l00389"></a>00389     <span class="keywordflow">if</span> ( ( SOL_SOCKET == level ) &amp;&amp; (
<a name="l00390"></a>00390             ( SO_PROTOCOL_INFOA == optname ) ||
<a name="l00391"></a>00391             ( SO_PROTOCOL_INFOW == optname )
<a name="l00392"></a>00392          )
<a name="l00393"></a>00393        )
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395         __try
<a name="l00396"></a>00396         {
<a name="l00397"></a>00397             <span class="keywordflow">switch</span> ( optname )
<a name="l00398"></a>00398             {
<a name="l00399"></a>00399                 <span class="keywordflow">case</span> SO_PROTOCOL_INFOA:
<a name="l00400"></a>00400                     <span class="keywordflow">if</span> (  *optlen &lt;= <span class="keyword">sizeof</span>( WSAPROTOCOL_INFOA ) )
<a name="l00401"></a>00401                     {
<a name="l00402"></a>00402                         *optlen = <span class="keyword">sizeof</span>( WSAPROTOCOL_INFOA );
<a name="l00403"></a>00403                         *lpErrno = WSAEFAULT;
<a name="l00404"></a>00404                         rc = SOCKET_ERROR;
<a name="l00405"></a>00405                         <span class="keywordflow">goto</span> cleanup;
<a name="l00406"></a>00406                     }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408                     *optlen = <span class="keyword">sizeof</span>( WSAPROTOCOL_INFOA );
<a name="l00409"></a>00409                     memcpy( optval, &amp;sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#a56549aa76ce9437bfa255d6e8505d3a">LayerProvider</a>,
<a name="l00410"></a>00410                             <span class="keyword">sizeof</span>( WSAPROTOCOL_INFOA ) );
<a name="l00411"></a>00411 
<a name="l00412"></a>00412                     <span class="keywordflow">break</span>;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414                 <span class="keywordflow">case</span> SO_PROTOCOL_INFOW:
<a name="l00415"></a>00415                     <span class="keywordflow">if</span> ( *optlen &lt;= <span class="keyword">sizeof</span>( WSAPROTOCOL_INFOW ) )
<a name="l00416"></a>00416                     {
<a name="l00417"></a>00417                         *optlen = <span class="keyword">sizeof</span>( WSAPROTOCOL_INFOW );
<a name="l00418"></a>00418                         *lpErrno = WSAEFAULT;
<a name="l00419"></a>00419                         rc = SOCKET_ERROR;
<a name="l00420"></a>00420                         <span class="keywordflow">goto</span> cleanup;
<a name="l00421"></a>00421                     }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423                     *optlen = <span class="keyword">sizeof</span>( WSAPROTOCOL_INFOW );
<a name="l00424"></a>00424                     memcpy( optval, &amp;sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#a56549aa76ce9437bfa255d6e8505d3a">LayerProvider</a>,
<a name="l00425"></a>00425                             <span class="keyword">sizeof</span>( WSAPROTOCOL_INFOW ) );
<a name="l00426"></a>00426 
<a name="l00427"></a>00427                     <span class="keywordflow">break</span>;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429             }
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431         __except( EXCEPTION_EXECUTE_HANDLER )
<a name="l00432"></a>00432         {
<a name="l00433"></a>00433             *lpErrno = WSAEFAULT;
<a name="l00434"></a>00434             rc = SOCKET_ERROR;
<a name="l00435"></a>00435             <span class="keywordflow">goto</span> cleanup;
<a name="l00436"></a>00436         }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <span class="keywordflow">if</span> ( SO_PROTOCOL_INFOA == optname )
<a name="l00439"></a>00439         {
<a name="l00440"></a>00440             WideCharToMultiByte( 
<a name="l00441"></a>00441                     CP_ACP, 
<a name="l00442"></a>00442                     0,
<a name="l00443"></a>00443                     sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#a56549aa76ce9437bfa255d6e8505d3a">LayerProvider</a>.szProtocol,
<a name="l00444"></a>00444                     -1,
<a name="l00445"></a>00445                     ( (WSAPROTOCOL_INFOA *)optval )-&gt;szProtocol,
<a name="l00446"></a>00446                     WSAPROTOCOL_LEN+1,
<a name="l00447"></a>00447                     NULL,
<a name="l00448"></a>00448                     NULL
<a name="l00449"></a>00449                     );
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452     <span class="keywordflow">else</span>
<a name="l00453"></a>00453     {
<a name="l00454"></a>00454         rc = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPGetSockOpt(
<a name="l00455"></a>00455                 s,
<a name="l00456"></a>00456                 level,
<a name="l00457"></a>00457                 optname,
<a name="l00458"></a>00458                 optval,
<a name="l00459"></a>00459                 optlen,
<a name="l00460"></a>00460                 lpErrno
<a name="l00461"></a>00461                 );
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 cleanup:
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     <span class="keywordflow">return</span> rc;
<a name="l00467"></a>00467 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="045adcc3ba0d8f55b7f5fd581b29f289"></a><!-- doxytag: member="spi.cpp::WSPIoctl" ref="045adcc3ba0d8f55b7f5fd581b29f289" args="(SOCKET s, DWORD dwIoControlCode, LPVOID lpvInBuffer, DWORD cbInBuffer, LPVOID lpvOutBuffer, DWORD cbOutBuffer, LPDWORD lpcbBytesReturned, LPWSAOVERLAPPED lpOverlapped, LPWSAOVERLAPPED_COMPLETION_ROUTINE lpCompletionRoutine, LPWSATHREADID lpThreadId, LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WSPAPI WSPIoctl           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&nbsp;</td>
          <td class="paramname"> <em>dwIoControlCode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPVOID&nbsp;</td>
          <td class="paramname"> <em>lpvInBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&nbsp;</td>
          <td class="paramname"> <em>cbInBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPVOID&nbsp;</td>
          <td class="paramname"> <em>lpvOutBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&nbsp;</td>
          <td class="paramname"> <em>cbOutBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPDWORD&nbsp;</td>
          <td class="paramname"> <em>lpcbBytesReturned</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSAOVERLAPPED&nbsp;</td>
          <td class="paramname"> <em>lpOverlapped</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSAOVERLAPPED_COMPLETION_ROUTINE&nbsp;</td>
          <td class="paramname"> <em>lpCompletionRoutine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSATHREADID&nbsp;</td>
          <td class="paramname"> <em>lpThreadId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00478">478</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00491"></a>00491 {
<a name="l00492"></a>00492     <a class="code" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a> *sockContext = NULL;
<a name="l00493"></a>00493     GUID            ConnectExGuid = WSAID_CONNECTEX;
<a name="l00494"></a>00494     <span class="keywordtype">int</span>             rc = NO_ERROR;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     <span class="comment">// If loading an extension function, check for ConnectEx</span>
<a name="l00497"></a>00497     <span class="keywordflow">if</span> ( SIO_GET_EXTENSION_FUNCTION_POINTER == dwIoControlCode )
<a name="l00498"></a>00498     {
<a name="l00499"></a>00499         <span class="keywordflow">if</span> ( 0 == memcmp( lpvInBuffer, &amp;ConnectExGuid, <span class="keyword">sizeof</span>( GUID ) ) )
<a name="l00500"></a>00500         {
<a name="l00501"></a>00501             <span class="comment">// Return a pointer to our intermediate extension function</span>
<a name="l00502"></a>00502             __try 
<a name="l00503"></a>00503             {
<a name="l00504"></a>00504                 <span class="keywordflow">if</span> ( cbOutBuffer &lt; <span class="keyword">sizeof</span>( LPFN_CONNECTEX ) )
<a name="l00505"></a>00505                 {
<a name="l00506"></a>00506                     *lpcbBytesReturned = <span class="keyword">sizeof</span>( LPFN_CONNECTEX );
<a name="l00507"></a>00507                     *lpErrno = WSAEFAULT;
<a name="l00508"></a>00508                     rc = SOCKET_ERROR;
<a name="l00509"></a>00509                     <span class="keywordflow">goto</span> cleanup;
<a name="l00510"></a>00510                 }
<a name="l00511"></a>00511                 *lpcbBytesReturned = <span class="keyword">sizeof</span>( LPFN_CONNECTEX );
<a name="l00512"></a>00512                 *((DWORD_PTR *)lpvOutBuffer) = (DWORD_PTR) <a class="code" href="extension_8cpp.html#40beaefdebcacedc5dfd15acc8c69ff8">ExtConnectEx</a>;
<a name="l00513"></a>00513             }
<a name="l00514"></a>00514             __except( EXCEPTION_EXECUTE_HANDLER )
<a name="l00515"></a>00515             {
<a name="l00516"></a>00516                 *lpErrno = WSAEFAULT;
<a name="l00517"></a>00517                 rc = SOCKET_ERROR;
<a name="l00518"></a>00518             }
<a name="l00519"></a>00519             <span class="keywordflow">return</span> rc;
<a name="l00520"></a>00520         }
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="comment">// Retrieve the socket context</span>
<a name="l00524"></a>00524     sockContext = <a class="code" href="lspdef_8h.html#6f2312b459597aa6a8021bb1303f6d8a">FindSocketContext</a>( s );
<a name="l00525"></a>00525     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00526"></a>00526     {
<a name="l00527"></a>00527         *lpErrno = WSAENOTSOCK;
<a name="l00528"></a>00528         rc = SOCKET_ERROR;
<a name="l00529"></a>00529         <span class="keywordflow">goto</span> cleanup;
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPIoctl );
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="comment">// Pass the call to the lower layer</span>
<a name="l00535"></a>00535     rc = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPIoctl(
<a name="l00536"></a>00536             s,
<a name="l00537"></a>00537             dwIoControlCode, 
<a name="l00538"></a>00538             lpvInBuffer,
<a name="l00539"></a>00539             cbInBuffer, 
<a name="l00540"></a>00540             lpvOutBuffer, 
<a name="l00541"></a>00541             cbOutBuffer, 
<a name="l00542"></a>00542             lpcbBytesReturned, 
<a name="l00543"></a>00543             lpOverlapped, 
<a name="l00544"></a>00544             lpCompletionRoutine, 
<a name="l00545"></a>00545             lpThreadId, 
<a name="l00546"></a>00546             lpErrno
<a name="l00547"></a>00547             );
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 cleanup:
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="keywordflow">return</span> rc;
<a name="l00552"></a>00552 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="152c06ee6e32c46e01087c6c31f89948"></a><!-- doxytag: member="spi.cpp::WSPSend" ref="152c06ee6e32c46e01087c6c31f89948" args="(SOCKET s, LPWSABUF lpBuffers, DWORD dwBufferCount, LPDWORD lpNumberOfBytesSent, DWORD dwFlags, LPWSAOVERLAPPED lpOverlapped, LPWSAOVERLAPPED_COMPLETION_ROUTINE lpCompletionRoutine, LPWSATHREADID lpThreadId, LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WSPAPI WSPSend           </td>
          <td>(</td>
          <td class="paramtype">SOCKET&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSABUF&nbsp;</td>
          <td class="paramname"> <em>lpBuffers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&nbsp;</td>
          <td class="paramname"> <em>dwBufferCount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPDWORD&nbsp;</td>
          <td class="paramname"> <em>lpNumberOfBytesSent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&nbsp;</td>
          <td class="paramname"> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSAOVERLAPPED&nbsp;</td>
          <td class="paramname"> <em>lpOverlapped</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSAOVERLAPPED_COMPLETION_ROUTINE&nbsp;</td>
          <td class="paramname"> <em>lpCompletionRoutine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSATHREADID&nbsp;</td>
          <td class="paramname"> <em>lpThreadId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00570">570</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00581"></a>00581 {
<a name="l00582"></a>00582     <a class="code" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a> *sockContext = NULL;
<a name="l00583"></a>00583     DWORD           i;
<a name="l00584"></a>00584     <span class="keywordtype">char</span>           *start = NULL,
<a name="l00585"></a>00585                     urlstr[ <a class="code" href="spi_8cpp.html#03292201bb4771719a391fbd31c4237f">DEFAULT_PRINT_BUFFER</a> ];
<a name="l00586"></a>00586     <span class="keywordtype">int</span>             rc = SOCKET_ERROR,
<a name="l00587"></a>00587                     len;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="comment">//</span>
<a name="l00590"></a>00590     <span class="comment">// Find our provider socket corresponding to this one</span>
<a name="l00591"></a>00591     <span class="comment">//</span>
<a name="l00592"></a>00592     sockContext = <a class="code" href="lspdef_8h.html#6f2312b459597aa6a8021bb1303f6d8a">FindSocketContext</a>( s );
<a name="l00593"></a>00593     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00594"></a>00594     {
<a name="l00595"></a>00595         *lpErrno = WSAENOTSOCK;
<a name="l00596"></a>00596         <span class="keywordflow">goto</span> cleanup;
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="comment">// Parse the send buffer and look for HTTP GET requests</span>
<a name="l00600"></a>00600     __try
<a name="l00601"></a>00601     {
<a name="l00602"></a>00602         <span class="keywordflow">for</span>(i=0; i &lt; dwBufferCount ;i++)
<a name="l00603"></a>00603         {
<a name="l00604"></a>00604             len = <a class="code" href="spi_8cpp.html#7dad64c6e124337603820bd11d462832">FindUrl</a>( lpBuffers[ i ].buf, lpBuffers[ i ].len, &amp;start );
<a name="l00605"></a>00605             <span class="keywordflow">if</span> ( ( len &gt; 0 ) &amp;&amp; ( len+1 &lt; <a class="code" href="spi_8cpp.html#03292201bb4771719a391fbd31c4237f">DEFAULT_PRINT_BUFFER</a> ) )
<a name="l00606"></a>00606             {
<a name="l00607"></a>00607                 <span class="keywordflow">if</span> ( FAILED (StringCchCopyN( urlstr, <a class="code" href="spi_8cpp.html#03292201bb4771719a391fbd31c4237f">DEFAULT_PRINT_BUFFER</a>, start, len+1 ) ) )
<a name="l00608"></a>00608                 {
<a name="l00609"></a>00609                     *lpErrno = WSAEFAULT;
<a name="l00610"></a>00610                     <span class="keywordflow">goto</span> cleanup;
<a name="l00611"></a>00611                 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613                 <span class="keywordflow">if</span> ( len &gt;= <a class="code" href="spi_8cpp.html#03292201bb4771719a391fbd31c4237f">DEFAULT_PRINT_BUFFER</a> )
<a name="l00614"></a>00614                     urlstr[ <a class="code" href="spi_8cpp.html#03292201bb4771719a391fbd31c4237f">DEFAULT_PRINT_BUFFER</a>-1 ] = <span class="charliteral">'\0'</span>;
<a name="l00615"></a>00615                 <span class="keywordflow">else</span>
<a name="l00616"></a>00616                     urlstr[len] = <span class="charliteral">'\0'</span>;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618                 <span class="comment">// URL can be logged but this just displays it to the debugger</span>
<a name="l00619"></a>00619                 <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"Found URL: '%s'"</span>, urlstr );
<a name="l00620"></a>00620             }
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623     __except( EXCEPTION_EXECUTE_HANDLER )
<a name="l00624"></a>00624     {
<a name="l00625"></a>00625         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPSend: ***access violation ***"</span>);
<a name="l00626"></a>00626         *lpErrno = WSAEFAULT;
<a name="l00627"></a>00627         <span class="keywordflow">goto</span> cleanup;
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPSend );
<a name="l00631"></a>00631 
<a name="l00632"></a>00632     <span class="comment">// Just pass the request along to the lower provider. NOTE: If we choose to</span>
<a name="l00633"></a>00633     <span class="comment">//    modify the data things get a bit trickier if we substitute our own send</span>
<a name="l00634"></a>00634     <span class="comment">//    buffer since we would need to be in the data notification path in order</span>
<a name="l00635"></a>00635     <span class="comment">//    to know when we are able to free that memory (i.e. the lower layer has</span>
<a name="l00636"></a>00636     <span class="comment">//    processed it and is done). In this case a non-IFS LSP is more appropriate</span>
<a name="l00637"></a>00637     <span class="comment">//    since it intercepts all IO completion notifications.</span>
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     rc = sockContext-&gt;<a class="code" href="struct__SOCKET__CONTEXT.html#e11e3bb4d7169250345f9f213dbd62f5">Provider</a>-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPSend(
<a name="l00640"></a>00640             s,
<a name="l00641"></a>00641             lpBuffers,
<a name="l00642"></a>00642             dwBufferCount, 
<a name="l00643"></a>00643             lpNumberOfBytesSent,
<a name="l00644"></a>00644             dwFlags,
<a name="l00645"></a>00645             lpOverlapped,
<a name="l00646"></a>00646             lpCompletionRoutine,
<a name="l00647"></a>00647             lpThreadId,
<a name="l00648"></a>00648             lpErrno
<a name="l00649"></a>00649             );
<a name="l00650"></a>00650 cleanup:
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="keywordflow">return</span> rc;
<a name="l00653"></a>00653 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9263b25bef174302fec2ee7b4713aa61"></a><!-- doxytag: member="spi.cpp::WSPSocket" ref="9263b25bef174302fec2ee7b4713aa61" args="(int af, int type, int protocol, LPWSAPROTOCOL_INFOW lpProtocolInfo, GROUP g, DWORD dwFlags, LPINT lpErrno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SOCKET WSPAPI WSPSocket           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>af</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>protocol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSAPROTOCOL_INFOW&nbsp;</td>
          <td class="paramname"> <em>lpProtocolInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GROUP&nbsp;</td>
          <td class="paramname"> <em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&nbsp;</td>
          <td class="paramname"> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPINT&nbsp;</td>
          <td class="paramname"> <em>lpErrno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00665">665</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00674"></a>00674 {
<a name="l00675"></a>00675     WSAPROTOCOL_INFOW   InfoCopy = {0};
<a name="l00676"></a>00676     <a class="code" href="struct__SOCKET__CONTEXT.html">SOCKET_CONTEXT</a>     *sockContext = NULL;
<a name="l00677"></a>00677     <a class="code" href="struct__PROVIDER.html">PROVIDER</a>           *lowerProvider = NULL;
<a name="l00678"></a>00678     SOCKET              nextProviderSocket = INVALID_SOCKET,
<a name="l00679"></a>00679                         sret = INVALID_SOCKET;
<a name="l00680"></a>00680     <span class="keywordtype">int</span>                 rc;
<a name="l00681"></a>00681 
<a name="l00682"></a>00682     <span class="comment">// Find the LSP entry which matches the given provider info</span>
<a name="l00683"></a>00683     lowerProvider = <a class="code" href="lspcommon_8h.html#4713657dbb312eafc00da02f514dc6fb">FindMatchingLspEntryForProtocolInfo</a>(
<a name="l00684"></a>00684             lpProtocolInfo,
<a name="l00685"></a>00685             <a class="code" href="lspdef_8h.html#f3639b63ffeaa56de64a8fb3f20f5e4f">gLayerInfo</a>,
<a name="l00686"></a>00686             <a class="code" href="lspdef_8h.html#71c050fcab3a91e3c6c59d0a5c8b69d1">gLayerCount</a>
<a name="l00687"></a>00687             );
<a name="l00688"></a>00688     <span class="keywordflow">if</span> ( NULL == lowerProvider )
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPSocket: FindMatchingLspEntryForProtocolInfo failed!"</span> );
<a name="l00691"></a>00691         <span class="keywordflow">goto</span> cleanup;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     <span class="keywordflow">if</span> ( 0 == lowerProvider-&gt;<a class="code" href="struct__PROVIDER.html#1231b41c6796828cbcb5d3db9a1b0b86">StartupCount</a> ) 
<a name="l00695"></a>00695     {
<a name="l00696"></a>00696         rc = <a class="code" href="lspcommon_8h.html#cdcd041b7b67f760687a34747fc42be6">InitializeProvider</a>( lowerProvider, MAKEWORD(2,2), lpProtocolInfo, 
<a name="l00697"></a>00697                <a class="code" href="lspdef_8h.html#2e86220b11aa751cf68d403988dd882d">gMainUpCallTable</a>, lpErrno );
<a name="l00698"></a>00698         <span class="keywordflow">if</span> ( SOCKET_ERROR == rc )
<a name="l00699"></a>00699         {
<a name="l00700"></a>00700             <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPSocket: InitializeProvider failed: %d"</span>, *lpErrno);
<a name="l00701"></a>00701             <span class="keywordflow">goto</span> cleanup;
<a name="l00702"></a>00702         }
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     <span class="comment">// If the next layer is a base, substitute the provider structure with the</span>
<a name="l00706"></a>00706     <span class="comment">//    base provider's</span>
<a name="l00707"></a>00707     <span class="keywordflow">if</span> ( BASE_PROTOCOL == lowerProvider-&gt;<a class="code" href="struct__PROVIDER.html#b6beb417b021197fe10b42b16d8be957">NextProvider</a>.ProtocolChain.ChainLen )
<a name="l00708"></a>00708     {
<a name="l00709"></a>00709         memcpy( &amp;InfoCopy, &amp;lowerProvider-&gt;<a class="code" href="struct__PROVIDER.html#b6beb417b021197fe10b42b16d8be957">NextProvider</a>, <span class="keyword">sizeof</span>( InfoCopy ) );
<a name="l00710"></a>00710         InfoCopy.dwProviderReserved = lpProtocolInfo-&gt;dwProviderReserved;
<a name="l00711"></a>00711         lpProtocolInfo = &amp;InfoCopy;
<a name="l00712"></a>00712     }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( lowerProvider-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPSocket );
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="comment">//</span>
<a name="l00717"></a>00717     <span class="comment">// Create the socket from the lower layer</span>
<a name="l00718"></a>00718     <span class="comment">//</span>
<a name="l00719"></a>00719     nextProviderSocket = lowerProvider-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPSocket(
<a name="l00720"></a>00720             af, 
<a name="l00721"></a>00721             type, 
<a name="l00722"></a>00722             protocol, 
<a name="l00723"></a>00723             lpProtocolInfo,
<a name="l00724"></a>00724             g, 
<a name="l00725"></a>00725             dwFlags,
<a name="l00726"></a>00726             lpErrno
<a name="l00727"></a>00727             );
<a name="l00728"></a>00728     <span class="keywordflow">if</span> ( INVALID_SOCKET == nextProviderSocket )
<a name="l00729"></a>00729     {
<a name="l00730"></a>00730         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPSocket: NextProcTable.WSPSocket failed: %d"</span>, *lpErrno);
<a name="l00731"></a>00731         <span class="keywordflow">goto</span> cleanup;
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     <span class="comment">//</span>
<a name="l00735"></a>00735     <span class="comment">// Create the context information to be associated with this socket</span>
<a name="l00736"></a>00736     <span class="comment">//</span>
<a name="l00737"></a>00737     sockContext = <a class="code" href="lspdef_8h.html#6d422aa5870787ade6e6065cdff0aa5f">CreateSocketContext</a>(
<a name="l00738"></a>00738             lowerProvider,
<a name="l00739"></a>00739             nextProviderSocket,
<a name="l00740"></a>00740             lpErrno
<a name="l00741"></a>00741             );
<a name="l00742"></a>00742     <span class="keywordflow">if</span> ( NULL == sockContext )
<a name="l00743"></a>00743     {
<a name="l00744"></a>00744         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>( <span class="stringliteral">"WSPSocket: CreateSocketContext failed: %d"</span>, *lpErrno );
<a name="l00745"></a>00745         <span class="keywordflow">goto</span> cleanup;
<a name="l00746"></a>00746     }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748     <span class="comment">//</span>
<a name="l00749"></a>00749     <span class="comment">// Associate ownership of this handle with our LSP</span>
<a name="l00750"></a>00750     <span class="comment">//</span>
<a name="l00751"></a>00751     sret = <a class="code" href="lspdef_8h.html#2e86220b11aa751cf68d403988dd882d">gMainUpCallTable</a>.lpWPUModifyIFSHandle(
<a name="l00752"></a>00752             lowerProvider-&gt;<a class="code" href="struct__PROVIDER.html#a56549aa76ce9437bfa255d6e8505d3a">LayerProvider</a>.dwCatalogEntryId,
<a name="l00753"></a>00753             nextProviderSocket,
<a name="l00754"></a>00754             lpErrno
<a name="l00755"></a>00755             );
<a name="l00756"></a>00756     <span class="keywordflow">if</span> ( INVALID_SOCKET == sret )
<a name="l00757"></a>00757     {
<a name="l00758"></a>00758         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>( <span class="stringliteral">"WSPSocket: WPUModifyIFSHandle failed: %d"</span>, *lpErrno );
<a name="l00759"></a>00759         <span class="keywordflow">goto</span> cleanup;
<a name="l00760"></a>00760     }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( sret == nextProviderSocket );
<a name="l00763"></a>00763 
<a name="l00764"></a>00764     <span class="keywordflow">return</span> nextProviderSocket;
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 cleanup:
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     <span class="comment">// If an error occured close the socket if it was already created</span>
<a name="l00769"></a>00769     <span class="keywordflow">if</span> ( ( NULL != sockContext ) &amp;&amp; ( NULL != lowerProvider ) &amp;&amp;
<a name="l00770"></a>00770          ( INVALID_SOCKET != nextProviderSocket ) )
<a name="l00771"></a>00771     {
<a name="l00772"></a>00772         rc = lowerProvider-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>.lpWSPCloseSocket(
<a name="l00773"></a>00773                 nextProviderSocket,
<a name="l00774"></a>00774                 lpErrno
<a name="l00775"></a>00775                 );
<a name="l00776"></a>00776         <span class="keywordflow">if</span> ( SOCKET_ERROR == rc )
<a name="l00777"></a>00777         {
<a name="l00778"></a>00778             <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>( <span class="stringliteral">"WSPSocket: WSPCloseSocket failed: %d"</span>, *lpErrno );
<a name="l00779"></a>00779         }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782     <span class="keywordflow">if</span> ( ( NULL != sockContext ) &amp;&amp; ( NULL != lowerProvider ) )
<a name="l00783"></a>00783         <a class="code" href="lspdef_8h.html#fa2103b5e5b6ad1a746a4d3533713d37">FreeSocketContext</a>( lowerProvider, sockContext );
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     <span class="keywordflow">return</span> INVALID_SOCKET;
<a name="l00786"></a>00786 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="63ec3df09eaf63af14d2f5237a9d29ee"></a><!-- doxytag: member="spi.cpp::WSPStartup" ref="63ec3df09eaf63af14d2f5237a9d29ee" args="(WORD wVersion, LPWSPDATA lpWSPData, LPWSAPROTOCOL_INFOW lpProtocolInfo, WSPUPCALLTABLE UpCallTable, LPWSPPROC_TABLE lpProcTable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WSPAPI WSPStartup           </td>
          <td>(</td>
          <td class="paramtype">WORD&nbsp;</td>
          <td class="paramname"> <em>wVersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSPDATA&nbsp;</td>
          <td class="paramname"> <em>lpWSPData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSAPROTOCOL_INFOW&nbsp;</td>
          <td class="paramname"> <em>lpProtocolInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WSPUPCALLTABLE&nbsp;</td>
          <td class="paramname"> <em>UpCallTable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LPWSPPROC_TABLE&nbsp;</td>
          <td class="paramname"> <em>lpProcTable</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00932">932</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00939"></a>00939 {
<a name="l00940"></a>00940     <a class="code" href="struct__PROVIDER.html">PROVIDER</a>           *loadProvider = NULL;
<a name="l00941"></a>00941     <span class="keywordtype">int</span>                 Error = WSAEPROVIDERFAILEDINIT,
<a name="l00942"></a>00942                         rc;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944     EnterCriticalSection( &amp;<a class="code" href="lspdef_8h.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a> );
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <span class="comment">// The first time the startup is called, create our heap and allocate some</span>
<a name="l00947"></a>00947     <span class="comment">//    data structures for tracking the LSP providers</span>
<a name="l00948"></a>00948     <span class="keywordflow">if</span> ( 0 == gStartupCount )
<a name="l00949"></a>00949     {
<a name="l00950"></a>00950         <span class="comment">// Create the heap for all LSP allocations</span>
<a name="l00951"></a>00951         rc = <a class="code" href="lspcommon_8h.html#7953136dac03bcd32fd849643ba4090a">LspCreateHeap</a>( &amp;Error );
<a name="l00952"></a>00952         <span class="keywordflow">if</span> ( SOCKET_ERROR == rc )
<a name="l00953"></a>00953         {
<a name="l00954"></a>00954             <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPStartup: LspCreateHeap failed: %d"</span>, Error );
<a name="l00955"></a>00955             <span class="keywordflow">goto</span> cleanup;
<a name="l00956"></a>00956         }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958         <span class="comment">// Find this LSP's entries in the Winsock catalog and build a map of them</span>
<a name="l00959"></a>00959         rc = <a class="code" href="lspcommon_8h.html#283cd12aa3448f88649ba4ae104f6590">FindLspEntries</a>( &amp;<a class="code" href="lspdef_8h.html#f3639b63ffeaa56de64a8fb3f20f5e4f">gLayerInfo</a>, &amp;<a class="code" href="lspdef_8h.html#71c050fcab3a91e3c6c59d0a5c8b69d1">gLayerCount</a>, &amp;Error );
<a name="l00960"></a>00960         <span class="keywordflow">if</span> ( FALSE == rc )
<a name="l00961"></a>00961         {
<a name="l00962"></a>00962             <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPStartup: FindLspEntries failed: %d"</span>, Error );
<a name="l00963"></a>00963             <span class="keywordflow">goto</span> cleanup;
<a name="l00964"></a>00964         }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966         <span class="comment">// Save off upcall table - this should be the same across all WSPStartup calls</span>
<a name="l00967"></a>00967         memcpy( &amp;<a class="code" href="lspdef_8h.html#2e86220b11aa751cf68d403988dd882d">gMainUpCallTable</a>, &amp;UpCallTable, <span class="keyword">sizeof</span>( <a class="code" href="lspdef_8h.html#2e86220b11aa751cf68d403988dd882d">gMainUpCallTable</a> ) );
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="comment">// Find the matching LSP provider for the requested protocol info passed in.</span>
<a name="l00972"></a>00972     <span class="comment">//    This can either be an LSP layered over use or an entry belonging to this</span>
<a name="l00973"></a>00973     <span class="comment">//    LSP. Note that the LSP startup gets called for each LSP layered protocol</span>
<a name="l00974"></a>00974     <span class="comment">//    entry with a unique GUID. Because of this each layered protocol entry for</span>
<a name="l00975"></a>00975     <span class="comment">//    the IFS LSP should be installed with its own unique GUID.</span>
<a name="l00976"></a>00976     loadProvider = <a class="code" href="lspcommon_8h.html#4713657dbb312eafc00da02f514dc6fb">FindMatchingLspEntryForProtocolInfo</a>(
<a name="l00977"></a>00977             lpProtocolInfo,
<a name="l00978"></a>00978             <a class="code" href="lspdef_8h.html#f3639b63ffeaa56de64a8fb3f20f5e4f">gLayerInfo</a>,
<a name="l00979"></a>00979             <a class="code" href="lspdef_8h.html#71c050fcab3a91e3c6c59d0a5c8b69d1">gLayerCount</a>,
<a name="l00980"></a>00980             TRUE
<a name="l00981"></a>00981             );
<a name="l00982"></a>00982     <span class="keywordflow">if</span> ( NULL == loadProvider )
<a name="l00983"></a>00983     {
<a name="l00984"></a>00984         <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPStartup: FindMatchingLspEntryForProtocolInfo failed!"</span>);
<a name="l00985"></a>00985         <a class="code" href="lspcommon_8h.html#092bd7bb2cb7fd9f483b6995cee61bc0">ASSERT</a>( 0 );
<a name="l00986"></a>00986         <span class="keywordflow">goto</span> cleanup;
<a name="l00987"></a>00987     }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989     <span class="comment">// If this is the first time to "load" this particular provider, initialize</span>
<a name="l00990"></a>00990     <span class="comment">//    the lower layer, etc.</span>
<a name="l00991"></a>00991     <span class="keywordflow">if</span> ( 0 == loadProvider-&gt;<a class="code" href="struct__PROVIDER.html#1231b41c6796828cbcb5d3db9a1b0b86">StartupCount</a> )
<a name="l00992"></a>00992     {
<a name="l00993"></a>00993 
<a name="l00994"></a>00994         rc = <a class="code" href="lspcommon_8h.html#cdcd041b7b67f760687a34747fc42be6">InitializeProvider</a>( loadProvider, wVersion, lpProtocolInfo, 
<a name="l00995"></a>00995                 UpCallTable, &amp;Error );
<a name="l00996"></a>00996         <span class="keywordflow">if</span> ( SOCKET_ERROR == rc )
<a name="l00997"></a>00997         {
<a name="l00998"></a>00998             <a class="code" href="lspcommon_8h.html#ee6d5a4f9ca8f62439bfd29633d96c1b">dbgprint</a>(<span class="stringliteral">"WSPStartup: InitializeProvider failed: %d"</span>, Error );
<a name="l00999"></a>00999             <span class="keywordflow">goto</span> cleanup;
<a name="l01000"></a>01000         }
<a name="l01001"></a>01001 
<a name="l01002"></a>01002     }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     gStartupCount++;
<a name="l01005"></a>01005 
<a name="l01006"></a>01006     <span class="comment">// Build the proc table to return to the caller</span>
<a name="l01007"></a>01007     memcpy( lpProcTable, &amp;loadProvider-&gt;<a class="code" href="struct__PROVIDER.html#0cd5cc9c28e3ca27672ce5245dd6f48d">NextProcTable</a>, <span class="keyword">sizeof</span>( *lpProcTable ) );
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     <span class="comment">// Override only those functions the LSP wants to intercept</span>
<a name="l01010"></a>01010     lpProcTable-&gt;lpWSPAccept        = <a class="code" href="spi_8cpp.html#4af8d3a0e7ccd2d8219c9a172b4c0993">WSPAccept</a>;
<a name="l01011"></a>01011     lpProcTable-&gt;lpWSPCleanup       = <a class="code" href="spi_8cpp.html#f498f85e68835b690146948c49141b0d">WSPCleanup</a>;
<a name="l01012"></a>01012     lpProcTable-&gt;lpWSPCloseSocket   = <a class="code" href="lspdef_8h.html#bb968dbf233213ef753854e39e67d645">WSPCloseSocket</a>;
<a name="l01013"></a>01013     lpProcTable-&gt;lpWSPConnect       = <a class="code" href="lspdef_8h.html#2c900291405ce06aa0df88d0be385261">WSPConnect</a>;
<a name="l01014"></a>01014     lpProcTable-&gt;lpWSPGetPeerName   = <a class="code" href="lspdef_8h.html#519725ece79c3dc4ef02c3ddd18947ce">WSPGetPeerName</a>;
<a name="l01015"></a>01015     lpProcTable-&gt;lpWSPGetSockOpt    = <a class="code" href="spi_8cpp.html#bb2fc8baae3676e0b96bc063fff51555">WSPGetSockOpt</a>;
<a name="l01016"></a>01016     lpProcTable-&gt;lpWSPIoctl         = <a class="code" href="lspdef_8h.html#045adcc3ba0d8f55b7f5fd581b29f289">WSPIoctl</a>;
<a name="l01017"></a>01017     lpProcTable-&gt;lpWSPSend          = <a class="code" href="spi_8cpp.html#152c06ee6e32c46e01087c6c31f89948">WSPSend</a>;
<a name="l01018"></a>01018     lpProcTable-&gt;lpWSPSocket        = <a class="code" href="lspdef_8h.html#9263b25bef174302fec2ee7b4713aa61">WSPSocket</a>;
<a name="l01019"></a>01019 
<a name="l01020"></a>01020     memcpy( lpWSPData, &amp;loadProvider-&gt;<a class="code" href="struct__PROVIDER.html#41983e606ffa19e74625d7fab05ab28c">WinsockVersion</a>, <span class="keyword">sizeof</span>( *lpWSPData ) );
<a name="l01021"></a>01021 
<a name="l01022"></a>01022     Error = NO_ERROR;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024 cleanup:
<a name="l01025"></a>01025 
<a name="l01026"></a>01026     LeaveCriticalSection( &amp;<a class="code" href="lspdef_8h.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a> );
<a name="l01027"></a>01027 
<a name="l01028"></a>01028     <span class="keywordflow">return</span> Error;
<a name="l01029"></a>01029 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="1c4ebd5b1b7602f65f6c712ede408c71"></a><!-- doxytag: member="spi.cpp::gCriticalSection" ref="1c4ebd5b1b7602f65f6c712ede408c71" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CRITICAL_SECTION <a class="el" href="spi_8cpp.html#1c4ebd5b1b7602f65f6c712ede408c71">gCriticalSection</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00045">45</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>

</div>
</div><p>
<a class="anchor" name="1097a55ef8326f3dd71c321b2b64a046"></a><!-- doxytag: member="spi.cpp::gLayerCount" ref="1097a55ef8326f3dd71c321b2b64a046" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="spi_8cpp.html#1097a55ef8326f3dd71c321b2b64a046">gLayerCount</a> = 0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00048">48</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>

</div>
</div><p>
<a class="anchor" name="2f9b8fb232be410a39ef4a9e2e42f806"></a><!-- doxytag: member="spi.cpp::gLayerInfo" ref="2f9b8fb232be410a39ef4a9e2e42f806" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__PROVIDER.html">LPPROVIDER</a> <a class="el" href="spi_8cpp.html#2f9b8fb232be410a39ef4a9e2e42f806">gLayerInfo</a> = NULL          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00047">47</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>

</div>
</div><p>
<a class="anchor" name="2e86220b11aa751cf68d403988dd882d"></a><!-- doxytag: member="spi.cpp::gMainUpCallTable" ref="2e86220b11aa751cf68d403988dd882d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WSPUPCALLTABLE <a class="el" href="spi_8cpp.html#2e86220b11aa751cf68d403988dd882d">gMainUpCallTable</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi_8cpp-source.html#l00046">46</a> of file <a class="el" href="spi_8cpp-source.html">spi.cpp</a>.</p>

</div>
</div><p>
</div>
</td>
</table>
<p><br><br></p>
<div class="footer width h">
	<div id="clearfix" class="copy">Copyright  2009 Komodia Inc. All rights reserved</div>
    <div class="foot_menu copy" id="clearfix"><a href="../../index.php.html" rel="nofollow">Home</a> | <a href="../../index.php@page=portfolio.html" rel="nofollow">Portfolio</a> | <a href="../../index.php@page=newservices.html" rel="nofollow">Services</a> | <a href="../../index.php@page=articles.html" rel="nofollow">Articles</a> | <a href="http://www.komodia.com/blog.htm" rel="nofollow" target="_new">Blog</a></div>
</div>
</body>
</html>
